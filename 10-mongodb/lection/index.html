<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>MongoDB</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css" id="theme">
    <link rel="stylesheet" href="../lib/css/zenburn.css">
    <link rel="stylesheet" href="./css/user.css">
</head>
<body class="yandex nodejs"><div class="reveal"><div class="slides">

<section class="large">
    <h3>–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h3>
    <h3>MongoDB</h3>
    <p class="author">
        <small>–ù–∞—Ç–∞–ª—å—è –ê–∫—Å—ë–Ω–æ–≤–∞</small>
    </p>
</section>
<section>
    <section data-transition="fade-in none-out">
        <ol>
            <li>Frontend</li>
            <li>Backend</li>
            <li>????</li>
            <li>PROFIT!!!</li>
        </ol>
    </section>
    <section data-transition="fade-in fade-out">
        <ol>
            <li>Frontend</li>
            <li>Backend</li>
            <li>Database</li>
            <li>PROFIT!!!</li>
        </ol>
    </section>
    <section>
        <h2>CAP —Ç–µ–æ—Ä–µ–º–∞</h2>
    </section>
    <section>
        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP" style="width: 85%;">
            –¢–µ–æ—Ä–µ–º–∞ CAP - —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –≤ –ª—é–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö –∏–∑ —Ç—Ä—ë—Ö —Å–ª–µ–¥—É—é—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤: —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é.
        </blockquote>
    </section>

    <section>
        <h3>C–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. consistency) ‚Äî –≤–æ –≤—Å–µ—Ö —É–∑–ª–∞—Ö —Å–∏—Å—Ç–µ–º—ã –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É
        </blockquote>
    </section>

    <section>
        <h3>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. availability) ‚Äî –∫–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å, –µ—Å–ª–∏ –∂–∏–≤ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É–∑–µ–ª —Å–∏—Å—Ç–µ–º—ã
        </blockquote>
    </section>

    <section>
        <h3>–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é</h3>

        <blockquote cite="https://ru.wikipedia.org/wiki/–¢–µ–æ—Ä–µ–º–∞_CAP">
            (–∞–Ω–≥–ª. partition tolerance) ‚Äî —Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–∫–ª–∏–∫–∞ –∫–∞–∂–¥–æ–π –∏–∑ —Å–µ–∫—Ü–∏–π
        </blockquote>
    </section>

    <section data-background='images/cap.png' data-background-size='contain'>
    </section>
    <section data-transition="fade-in none-out">
        <h3>SQL</h3>
        <img src="images/g7K2e.jpg" width="600">
    </section>
    <section data-transition="fade-in fade-out">
        <h3>SQL</h3>
        <img src="images/893533a3625e5f1f0e2f5641cd0f12e2.jpg">
    </section>
    <section>
        <h3>NoSQL</h3>
    </section>
    <section>
        <table>
            <tr>
                <td>Frontend</td>
                <td>Backend</td>
                <td>Database</td>
            </tr>
            <tr>
                <td class="fragment">Javascript</td>
                <td class="fragment">Javascript</td>
                <td class="fragment">Javascript</td>
            </tr>
        </table>
    </section>
</section>

<section>
    <section>
        <img src="images/MongoDB_Gray_Logo_FullColor_RGB-01.jpg">
    </section>
    <section>
        <h3>MongoDB</h3>
        <div>–î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
        <div>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON-–ø–æ–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (BSON)</div>
        <div>–î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Javascript</div>
        <div>–°—Ö–µ–º–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</div>
    </section>
    <section>
        <h4>–£—Å—Ç–∞–Ω–æ–≤–∫–∞</h4>
        <a href="https://www.mongodb.com/download-center#community">https://www.mongodb.com/download-center#community</a>
    </section>
    <section>
        <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–ó–∞–º–µ—Ç–∫–∏"</h2>
    </section>
    <section>
            <h3>CRUD</h3>
        <ul>
            <li>Create</li>
            <li>Read</li>
            <li>Update</li>
            <li>Delete</li>
        </ul>
    </section>
    <section>
        <h4>Create. –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å</h4>
        <pre><code class="hljs javascript size-XS">db.notes.insert({
    name: 'Films',
    text: 'My films',
    owner: '–ù–∞—Ç–∞–ª—å—è'
})
</code></pre>
    </section>
    <section>
        <h4>Create. –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π</h4>
    <pre><code class="hljs javascript">db.notes.insert([
    {
        name: '–ó–∞–º–µ—Ç–∫–∞ –±–µ–∑ –≤–ª–∞–¥–µ–ª—å—Ü–∞',
        text: '–ß—å—è —ç—Ç–æ –∑–∞–º–µ—Ç–∫–∞?'
    },
    {
        name: 1,
        owner: '–ù–∞—Ç–∞–ª—å—è'
    },
    {
        some: 'field'
    }
])</code></pre>
        <p class="fragment" style="font-size: 80px;">üìÑ  ü§∑  ‚ùì</p>
    </section>
    <section>
        <img src="images/trash.png">
    </section>
    <section>
        <h4>–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h4>
        <pre><code class="hljs javascript size-XXS">db.createCollection("notes", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["name", "owner"],
            properties: {
                name: { bsonType: "string", description: "Note title" },
                text: { bsonType: "string", description: "Note text" },
                owner: {
                    anyOf: [
                        { bsonType: "string" },
                        { bsonType: "array", items: { bsonType: "string" } }
                    ],
                    description: "Name of owner"
                }
}}}})</code></pre>
    </section>
    <section>
        <h4>Create. –£—Å–ø–µ—à–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h4>
        <pre style="margin-bottom: 30px;"><code class="hljs javascript">db.notes.insert(
    { name: 'Films', text: 'My films', owner: '–ù–∞—Ç–∞–ª—å—è' }
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">// WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h4>Create. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</h4>
        <pre style="margin-bottom: 30px;"><code class="hljs javascript">db.notes.insert({
    name: 'Books',
    owner: '–ù–∞—Ç–∞–ª—å—è',
    version: 2
})</code></pre>
        <pre class="fragment"><code class="hljs javascript">// WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h4>Create. –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏</h4>
        <pre style="margin-bottom: 30px;"><code class="hljs javascript">db.notes.insert({ name: 1, owner: '–ù–∞—Ç–∞–ª—å—è' })</code></pre>
        <pre class="fragment"><code class="hljs bash">WriteResult({
	"nInserted" : 0,
	"writeError" : {
		"code" : 121,
		"errmsg" : "Document failed validation"
	}
})</code></pre>
    </section>

    <section>
        <h4>Read. –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h4>
<pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find()</code></pre>
<pre class="fragment"><code class="hljs javascript">{ "_id" : ObjectId("5ab77143f92855790b23a184"), "name" : "Films", "text" : "my films", "owner" : "–ù–∞—Ç–∞–ª—å—è" }
{ "_id" : ObjectId("5ab77159f92855790b23a185"), "name" : "Books", "owner" : "–ù–∞—Ç–∞–ª—å—è", "version" : 2 }</code></pre>
    </section>
    <section>
        <h4>Read. Pretty</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find().pretty()</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab77143f92855790b23a184"),
    "name" : "Films",
    "text" : "My films",
    "owner" : "–ù–∞—Ç–∞–ª—å—è"
}
{
    "_id" : ObjectId("5ab77159f92855790b23a185"),
    "name" : "Books",
    "owner" : "–ù–∞—Ç–∞–ª—å—è",
    "version": 2
}</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find().toArray()</code></pre>
        <pre><code class="hljs javascript">[
    {
        "_id" : ObjectId("5ab77143f92855790b23a184"),
        "name" : "Films",
        "text" : "my films",
        "owner" : "–ù–∞—Ç–∞–ª—å—è"
    },
    {
        "_id" : ObjectId("5ab77159f92855790b23a185"),
        "name" : "Books",
        "owner" : "–ù–∞—Ç–∞–ª—å—è",
        "version": 2
    }
]</code></pre>
    </section>
    <section>
        <p>ObjectId("5ab77143f92855790b23a184")</p>
        <table>
            <tr>
                <td>4 –±–∞–π—Ç–∞</td>
                <td>timestamp</td>
            </tr>
            <tr>
                <td>3 –±–∞–π—Ç–∞</td>
                <td>mid</td>
            </tr>
            <tr>
                <td>2 –±–∞–π—Ç–∞</td>
                <td>pid</td>
            </tr>
            <tr>
                <td>3 –±–∞–π—Ç–∞</td>
                <td>inc</td>
            </tr>
        </table>
    </section>
    <section>
        <h4>Read. Find</h4>
<pre><code class="hljs javascript size-XS">db.collection.find(query, projection)</code></pre>
        <div>
            <ul>
                <li>query - –∑–∞–¥–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∫–∏. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</li>
                <li>projection - –∑–∞–¥–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –ø–æ–ª—è. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è</li>
            </ul>
        </div>
    </section>

    <section>
        <h4>Read. Query</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find({ name: 'Films' })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab77143f92855790b23a184"),
    "name" : "Films",
    "text" : "My films",
    "owner" : "–ù–∞—Ç–∞–ª—å—è"
}
        </code></pre>
    </section>
    <section>
        <h4>Read. Projection</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find({ owner: '–ù–∞—Ç–∞–ª—å—è' }, { name: 1 })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "_id" : ObjectId("5ab77143f92855790b23a184"),
    "name" : "Films"
}
{
    "_id" : ObjectId("5ab77159f92855790b23a185"),
    "name" : "Books"
}</code></pre>
    </section>
    <section>
        <h4>Read. Projection. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find({ owner: '–ù–∞—Ç–∞–ª—å—è' }, { name: 1, _id: 0 })</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "name" : "Films"
}
{
    "name" : "Books"
}</code></pre>
    </section>
    <section>
        <h4>Read. –û–ø–µ—Ä–∞—Ç–æ—Ä—ã</h4>
        <pre><code class="hljs javascript">db.notes.find({
    version: { $gte: 2 }
})</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/query/">–°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</a>
    </section>

    <section>
        <h4>Read. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</h4>
        <pre><code class="hljs javascript">db.notes.find({
    text: { $regex: /^my/i}
})</code></pre>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find({
    text: /^my/i
})</code></pre>
        <pre class="fragment"><code>{
    "_id" : ObjectId("5ab77143f92855790b23a184"),
    "name" : "Films",
    "text" : "My films",
    "owner" : "–ù–∞—Ç–∞–ª—å—è"
}</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/query/regex/">–ü–æ–∏—Å–∫ –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º</a>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É</h4>
        <pre><code class="hljs javascript">{
    "name" : "Books",
    "owner" : "–ù–∞—Ç–∞–ª—å—è"
}
{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ]
}
{
    "name" : "Music",
    "owner" : "–í–∞—Å—è"
}</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –º–∞—Å—Å–∏–≤—É</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">db.notes.find(
    { owner: '–ù–∞—Ç–∞–ª—å—è' },
    { _id: 0, name: 1, owner: 1 }
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "name" : "Books",
    "owner" : "–ù–∞—Ç–∞–ª—å—è"
}
{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ]
}</code></pre>
    </section>
    <section>
        <h4>Read. –ü–æ–∏—Å–∫ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</h4>
        <pre style="margin-bottom: 20px;"><code class="hljs javascript">db.notes.find({
    'score.likes': { $gte: 1 }
})</code></pre>
        <pre style="margin-bottom: 10px;"><code>{
    name: 'Films',
    owner: '–ù–∞—Ç–∞–ª—å—è',
    score: {
        likes: 10,
        dislikes: 2
    }
}</code></pre>
    </section>
    <section>
        <h4>Read. Sort, skip, limit</h4>
        <pre style="margin-bottom: 15px;"><code>db.notes.find({}, { _id: 0, owner: 1, name: 1 })</code></pre>
        <pre><code>{ "name" : "Music", "owner" : "–í–∞—Å—è" }
{ "name" : "Films", "owner" : "–ù–∞—Ç–∞–ª—å—è" }
{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ]
}
{ "name" : "Books", "owner" : "–ù–∞—Ç–∞–ª—å—è" }</code></pre>
    </section>
    <section>
        <h4>Read. Sort</h4>
        <pre style="margin-bottom: 15px;"><code>db.notes
    .find({}, { _id: 0, name: 1, owner: 1 })
    .sort({ name: 1 })</code></pre>
        <pre class="fragment"><code>{ "name" : "Books", "owner" : "–ù–∞—Ç–∞–ª—å—è" }
{ "name" : "Films", "owner" : "–ù–∞—Ç–∞–ª—å—è" }
{ "name" : "Films for party", "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ] }
{ "name" : "Music", "owner" : "–í–∞—Å—è" }</code></pre>
    </section>
    <section>
        <h4>Read. Limit</h4>
        <pre style="margin-bottom: 15px;"><code>db.notes
    .find({}, { _id: 0, name: 1, owner: 1 })
    .limit(2)</code></pre>
        <pre class="fragment"><code>{ "name" : "Films", "owner" : "–ù–∞—Ç–∞–ª—å—è" }
{ "name" : "Books", "owner" : "–ù–∞—Ç–∞–ª—å—è" }</code></pre>
    </section>
    <section>
        <h4>Read. Skip</h4>
        <pre style="margin-bottom: 15px;"><code>db.notes
    .find({}, { _id: 0, name: 1, owner: 1 })
    .skip(2)</code></pre>
        <pre class="fragment"><code>{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ]
}
{
    "name" : "Music",
    "owner" : "–í–∞—Å—è"
}</code></pre>
    </section>
    <section>
        <h4>Read. Sort-skip-limit</h4>
        <pre style="margin-bottom: 10px;"><code>db.notes
    .find({}, { _id: 0, name: 1, owner: 1 })
    .sort({ name: 1 })
    .skip(2)
    .limit(1)</code></pre>
        <pre class="fragment"><code>{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞" ]
}</code></pre>
    </section>
    <section>
        <h4>Read. Count</h4>
        <pre><code>db.notes.count({ owner: '–ù–∞—Ç–∞–ª—å—è' }) // 3</code></pre>
        <pre class="fragment"><code>db.notes.count() // 4</code></pre>
    </section>
    <section>
        <h4>Update</h4>
        <pre><code class="hljs javascript size-XS">db.collection.update(query, update, options)</code></pre>
        <a href="https://docs.mongodb.com/manual/reference/operator/update/">–°–ø–∏—Å–æ–∫ update –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤</a>
    </section>
    <section>
        <h4>Update. Set</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript size-XS">db.notes.update(
    { version: { $exists: false }}, // query
    { $set: { version: 1 }}        // update
)</code></pre>
        <pre class="fragment"><code>{ "name" : "Films", "version" : 1 }
{ "name" : "Books", "version" : 2 }
{ "name" : "Films for party" }
{ "name" : "Music" }</code></pre>
    </section>
    <section>
        <h4>Update. Multi</h4>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript size-XS">db.notes.update(
    { version: { $exists: false }},
    { $set: { version: 1 }},
    { multi: true }
)</code></pre>
        <pre class="fragment"><code>{ "name" : "Films", "version" : 1 }
{ "name" : "Books", "version" : 2 }
{ "name" : "Films for party", "version" : 1 }
{ "name" : "Music", "version" : 1 }</code></pre>
    </section>
    <section>
        <h4>Update. Increment</h4>
        <pre style="margin-bottom: 20px;"><code class="hljs javascript">db.notes.update(
    { name: 'Books' },
    { $inc: { version: 1 }}
)</code></pre>
        <pre class="fragment"><code>{ "name" : "Books", "version" : 3 }</code></pre>
    </section>
    <section>
        <h4>Update. Push</h4>
        <pre style="margin-bottom: 15px;"><code class="hljs javascript">db.notes.update(
    { name: 'Films for party' },
    { $push: { owner: '–ö–∞—Ç—è' }}
)</code></pre>
        <pre class="fragment"><code class="hljs javascript">{
    "name" : "Films for party",
    "owner" : [ "–ù–∞—Ç–∞–ª—å—è", "–ê–Ω–Ω–∞", "–ö–∞—Ç—è" ]
}</code></pre>
    </section>
    <section>
        <h4>Delete</h4>
        <pre style="margin-bottom: 15px;"><code class="hljs javascript" data-trim>db.collection.remove(query, justOne)</code></pre>
        <pre style="margin-bottom: 15px;" class="fragment"><code class="hljs javascript">db.notes.remove({})</code></pre>
        <pre class="fragment"><code class="hljs javascript">db.notes.remove({}, true)</code></pre>
    </section>
</section>

<section>
    <section>
        <h4>–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–ª–µ–∫—Ü–∏–π</h4>
        <pre class="fragment" style="margin-bottom: 20px;"><code class="hljs javascript">db.users.insert({
    name: '–ù–∞—Ç–∞–ª—å—è',
    notes: ['Films', 'Books', 'Films for party']
})</code></pre>
    </section>
    <section data-transition="fade-in none-out">
        <h4>–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h4>
        <pre style="margin-bottom: 20px;"><code class="hljs javascript">db.notes.remove(
     { name: 'Films', owner: '–ù–∞—Ç–∞–ª—å—è' }
)</code></pre>
        <pre><code class="hljs javascript">db.users.update(
    { name: '–ù–∞—Ç–∞–ª—å—è' },
    { $pull: { notes: 'Films' }}
)</code></pre>
    </section>
    <section data-transition="none-in fade-out">
        <h4>–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h4>
        <pre style="margin-bottom: 20px; background-color: rgba(0,255,0,0.2)"><code class="hljs javascript">db.notes.remove(
     { name: 'Films', owner: '–ù–∞—Ç–∞–ª—å—è' }
)</code></pre>
        <pre style="background-color: rgba(255,0,0,0.2)"><code class="hljs javascript">db.users.update(
    { name: '–ù–∞—Ç–∞–ª—å—è' },
    { $pull: { notes: 'Films' }}
)</code></pre>
    </section>
    <section>
        <h3>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
        <div class="fragment">–ò—Ö –Ω–µ—Ç.</div>
        <div class="fragment">–ù–æ –±—É–¥—É—Ç –≤ MongoDB 4.0</div>
    </section>
</section>

<section>
    <section>
        <h3>–ò–Ω–¥–µ–∫—Å—ã</h3>
    </section>
    <section>
        <pre><code>db.notes.count() // 1 000 004 </code></pre>
        <pre><code>db.notes.count({ owner: '–ù–∞—Ç–∞–ª—å—è' }) // 3</code></pre>
    </section>
    <section>
        <h4>–ò–Ω–¥–µ–∫—Å—ã. Explain</h4>
        <pre style="margin-bottom: 15px;"><code class="hljs javascript">db.notes
    .find({ owner: '–ù–∞—Ç–∞–ª—å—è' })
    .explain('executionStats')</code></pre>
        <pre class="fragment"><span>{
    "nReturned" : 3,
    <mark>"executionTimeMillis" : 389,</mark>
    "totalKeysExamined" : 0,
    <mark>"totalDocsExamined" : 1000004,</mark>
    "executionStages" : {
        "stage" : "COLLSCAN",
        "filter" : {
            "owner" : { "$eq" : "–ù–∞—Ç–∞–ª—å—è" }
        }
    }
}</span></pre>
    </section>
    <section>
        <h3>–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞</h3>
        <pre><code class="hljs javascript size-XS">db.notes.createIndex({owner: 1})</code></pre>
    </section>
    <section>
        <h3>–ü–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É</h3>
        <pre style="margin-bottom: 15px;"><code class="hljs">db.notes
    .find({ owner: '–ù–∞—Ç–∞–ª—å—è' })
    .explain('executionStats')</code></pre>
        <pre class="fragment"><span>{
    "nReturned" : 3,
    <mark>"executionTimeMillis" : 19,</mark>
    "totalKeysExamined" : 3,
    <mark>"totalDocsExamined" : 3,</mark>
    "executionStages" : {
        "stage" : "FETCH",
        "inputStage" : {
            "stage" : "IXSCAN",
        }
    }
}</span></pre>
    </section>
    <section>
        <h3>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å. –°–æ–∑–¥–∞–Ω–∏–µ</h3>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript size-XS">db.users.createIndex({name: 1}, {unique: true})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">db.users.insert({name: '–ù–∞—Ç–∞–ª—å—è'})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">WriteResult({ "nInserted" : 1 })</code></pre>
    </section>
    <section>
        <h3>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å</h3>
        <pre><code class="hljs javascript size-XS">db.users.insert({name: '–ù–∞—Ç–∞–ª—å—è'})</code></pre>
        <pre class="fragment"><code class="hljs javascript size-XS">WriteResult({
    "nInserted" : 0,
    "writeError" : {
        "code" : 11000,
        "errmsg" : "E11000 duplicate key
            error collection:
            notes-lecture.notes
            index: name_1 dup key: { : \"–ù–∞—Ç–∞–ª—å—è\" }"
    }
})</code></pre>
    </section>
    <section>
        <h4>–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å</h4>
        <pre><code class="hljs javascript size-XS">db.notes.createIndex(
    {
        'score.likes': -1,
        name: 1
    }
)</code></pre>
    </section>
    <section>
        <h4>–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</h4>
        <pre><code>db.notes
    .find()
    .sort({ 'score.likes': -1, name: 1 })
    .explain()</code></pre>
        <pre class="fragment" style="margin-top: 20px;"><span>{
    "inputStage" : {
        <mark>"stage" : "IXSCAN",</mark>
        "keyPattern" : {
            "score.likes" : -1,
            "name" : 1
        },
        <mark>"indexName" : "score.likes_-1_name_1"</mark>
    }
}</span></pre>
    </section>
    <section>
        <h4>–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</h4>
        <pre><code>db.notes
    .find()
    .sort({ 'score.likes': 1, name: 1 })
    .explain()</code></pre>
        <pre class="fragment" style="margin-top: 20px;"><span>{
    "stage" : "SORT",
    "sortPattern" : {
        "score.likes" : 1,
        "name" : 1
    },
    "inputStage" : {
        "stage" : "SORT_KEY_GENERATOR",
        "inputStage" : {
            <mark>"stage" : "COLLSCAN",</mark>
            "direction" : "forward"
        }
    }
}</span></pre>
    </section>
    <section>
        <h4>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤</h4>
        <pre><code data-trim class="hljs javascript size-XS">db.notes.getIndexes()</code></pre>
        <pre><code data-trim class="hljs json size-XXS">[
	{
		"v" : 2,
		"key" : { "_id" : 1 },
		"name" : "_id_",
		"ns" : "notes-lecture.notes"
	},
	{
		"v" : 2,
		"key" : { "owner" : 1 },
		"name" : "owner_1",
		"ns" : "notes-lecture.notes"
	}
]</code></pre>
    </section>
</section>
<section>
    <section>
        <h2>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
    </section>
    <section>
        <img src="images/giphy%20(6).gif">
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –ó–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ</h4>
        <img style="background-color: #fff;" src="images/replica-set-1.svg">
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã</h4>
        <img style="background-color: #fff;" src="images/replica-set-2.svg">
    </section>
    <section>
        <h4>–†–µ–ø–ª–∏–∫–∞—Ü–∏—è. –û—Ç–∫–∞–∑ —É–∑–ª–∞</h4>
        <img style="background-color: #fff;" src="images/replica-set-3.svg">
    </section>
    <section data-background='images/cap.png' data-background-size='contain'>
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
        <img style="background-color: #fff;" src="images/Biggest%20Book%20Ever.jpg">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
        <img style="background-color: #fff;" width="600" src="images/sharded-collection.png">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ. Range-based</h4>
        <img style="background-color: #fff;" src="images/sharded-cluster-ranged-distribution-good.bakedsvg.svg">
    </section>
    <section>
        <h4>–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ. Hash-based</h4>
        <img style="background-color: #fff;" height="400" src="images/sharding-hash-based.svg">
    </section>
</section>


<section>
    <section>
        <h2>ODM</h2>
        <span>Object Document Mapper</span>
    </section>
    <section>
        <h2>Mongoose</h2>
    </section>
    <section>
        <h3>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
        <pre style="margin-bottom: 15px;"><code class="hljs bash">npm install mongoose</code></pre>
        <pre><code data-trim class="hljs javascript">const mongoose = require('mongoose');
const URI = 'mongodb://localhost/mongo-lecture';

mongoose.connect(URI).then(
    () => { /** ready to use */ },
    err => { /** handle initial connection error */ }
)</code></pre>
    </section>
    <section>
        <h4>–°—Ö–µ–º—ã</h4>
        <pre><code class="hljs javascript">const Schema = mongoose.Schema;

const noteSchema = new Schema({
    name: { type: String, required: true },
    text: String,
    owner: { type: [String], required: true }
});</code></pre>
        <a href="http://mongoosejs.com/docs/schematypes.html" class="size-S">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Å—Ö–µ–º—ã</a>
    </section>
    <section>
        <h4>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º</h4>
        <pre><code class="hljs javascript">noteSchema.add({
    version: { type: Number, default: 1 }
});</code></pre>
    </section>
    <section>
        <h3>–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö</h3>
        <table>
            <tr>
                <td>String</td>
                <td>Number</td>
            </tr>
            <tr>
                <td>Date</td>
                <td>Buffer</td>
            </tr>
            <tr>
                <td>Boolean</td>
                <td>Array</td>
            </tr>
            <tr>
                <td>ObjectID</td>
                <td>Mixed</td>
            </tr>
        </table>
    </section>
    <section>
        <h3>–°—Ö–µ–º—ã. –ò–Ω–¥–µ–∫—Å—ã</h3>
        <pre style="margin-bottom: 20px;"><code class="hljs javascript">const userSchema = new Schema({
    name: {
        type: String, index: true, unique: true
    },
    notes: [String]
});</code></pre>
        <pre class="fragment"><code>noteSchema.index({ owner: 1, name: 1 });</code></pre>
    </section>
    <section>
        <h3>–ú–æ–¥–µ–ª–∏</h3>
        <pre style="margin-bottom: 10px;"><code class="hljs javascript">const Note = mongoose.model('Note', noteSchema);</code></pre>
<pre class="fragment"><code class="hljs javascript">const films = new Note({
    name: 'Films',
    owner: '–ù–∞—Ç–∞–ª—å—è',
    text: 'My films'
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">console.log(films.name); // "Films"
console.log(films.owner); // ["–ù–∞—Ç–∞–ª—å—è"]
console.log(films.version); // 1
        </code></pre>
    </section>
    <section>
        <h3>–ú–æ–¥–µ–ª–∏. –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–ª—è</h3>
        <pre><code class="hljs javascript">noteSchema.virtual('nameAndVersion').get(function () {
  return `${this.name}, –≤–µ—Ä—Å–∏—è ${this.version}`;
});</code></pre>
<pre class="fragment"><code class="hljs javascript">const Note = mongoose.model('Note', noteSchema);

const films = new Note({
    name: 'Films',
    owner: '–ù–∞—Ç–∞–ª—å—è'
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">console.log(films.nameAndVersion); // Films, –≤–µ—Ä—Å–∏—è 1</code></pre>
    </section>
    <section>
        <h2>CRUD</h2>
    </section>
    <section>
        <h3>Create</h3>
        <pre><code class="hljs javascript">const books = new Note({
    name: 'Books',
    owner: '–ù–∞—Ç–∞–ª—å—è'
});</code></pre>
        <pre class="fragment"><code class="hljs javascript">books
  .save()
  .then(function (savedNote) {console.log('Saved')})
  .catch(function (err) {console.log('Error:', err)});</code></pre>
    </section>
    <section>
        <h3>Read</h3>
        <pre><code class="hljs javascript">const query = Note.find({owner: '–ù–∞—Ç–∞–ª—å—è'});</code></pre>
        <pre style="margin-bottom:15px;" class="fragment"><code class="hljs javascript">query.where({version: {$gte: 2}});
query.select({name: 1, owner: 1});</code></pre>
        <pre class="fragment" style="margin-bottom: 10px;"><code>query.exec()
     .then(note => { console.log('found note': , note) })
     .catch(err => { console.log('error: ', err) });</code></pre>
        <pre class="fragment"><code>[ { owner: [ '–ù–∞—Ç–∞–ª—å—è' ],
    _id: 5ab77159f92855790b23a185,
    name: 'Books' } ]</code></pre>
    </section>
    <section>
        <h3>Read. Sort, skip, limit</h3>
        <pre><code class="hljs javascript">Note
    .find({ version: { $gte: 1 }})
    .sort({ owner: 1, name: 1 })
    .skip(1)
    .limit(20)
    .select({ owner: 1, name: 1, version: 1 })
    .exec();</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">note.update({ $inc: { version: 1 }})</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">Note
    .findById(ObjectId("5ab77143f92855790b23a184"))
    .then(note => {
        note.text += ' new text';
        return note.save();
    })
    .then(saved => {
        console.log('saved successfully!', saved);
    });</code></pre>
    </section>
    <section>
        <h3>Update</h3>
        <pre><code class="hljs javascript">Note
    .update(
        {},
        { $inc: { version: 1 }},
        { multi: true }
    )
    .then(() => {console.log('updated'})</code></pre>
    </section>
    <section>
        <h3>Delete</h3>
        <pre><code class="hljs javascript">Note.remove({name: 'Books'})</code></pre>
    </section>
</section>
<section>
    <section>
        <h3>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MongoDB</h3>
        <ul>
            <li class="fragment">–ü—Ä–æ—Å—Ç–æ—Ç–∞</li>
            <li class="fragment">–†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö</li>
            <li class="fragment">–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã - –≥–∏–±–∫–∞—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö</li>
            <li class="fragment">–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</li>
        </ul>
    </section>
    <section>
        <h2>–°—Å—ã–ª–∫–∏</h2>
        <ul>
            <li><a href="http://smira.ru/posts/cap-theorem-in-plain-russian.html">CAP-—Ç–µ–æ—Ä–µ–º–∞ –ø—Ä–æ—Å—Ç—ã–º, –¥–æ—Å—Ç—É–ø–Ω—ã–º —è–∑—ã–∫–æ–º</a></li>
            <li><a href="https://docs.mongodb.com/manual/">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è MongoDB 3.6</a></li>
            <li><a href="http://mongoosejs.com/docs/guide.html">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Mongoose</a></li>
            <li><a href="https://university.mongodb.com/courses/M101JS/about">–ö—É—Ä—Å –ø–æ MongoDB (–Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ)</a></li>
            <li><a href="https://docs.mongodb.com/manual/reference/sql-comparison/">SQL to MongoDB Mapping Chart</a></li>
        </ul>
    </section>
    <section>
        <h3>–°–ø–∞—Å–∏–±–æ!</h3>
        <h4>–í–æ–ø—Ä–æ—Å—ã?</h4>
    </section>
</section>


<script src="../lib/js/head.min.js"></script>
<script src="../js/reveal.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        hideAddressBar: true,
        transition: 'slide',
        dependencies: [
            {
                src: '../plugin/highlight/highlight.js',
                async: true,
                condition: function () {
                    return Boolean(document.querySelector('pre code'));
                },
                callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>
</body>
</html>
